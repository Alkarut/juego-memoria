<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CLEANMANT ULTIMATE - PHOTO REALISTIC</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; background: #000; color: #fff; 
            text-align: center; font-family: 'Press Start 2P', cursive; 
            overflow: hidden; touch-action: none; 
        }
        #game-wrapper {
            position: relative; margin: 10px auto;
            width: 400px; height: 600px;
            max-width: 95vw; max-height: 85vh;
            border: 4px solid #00ffff;
            box-shadow: 0 0 25px #00ffff;
            /* FONDO DE CIRCUITOS REALISTA */
            background-image: url('https://img.freepik.com/vector-premium/fondo-placa-circuito-estilo-futurista_23-2148403402.jpg');
            background-size: cover;
        }
        .ui-panel {
            position: absolute; top: 0; width: 100%;
            display: flex; justify-content: space-around;
            padding: 15px 0; background: rgba(0,0,0,0.8);
            font-size: 10px; color: #00ffff; z-index: 10;
            border-bottom: 2px solid #00ffff;
        }
        .progress-bar { width: 120px; height: 12px; border: 1px solid #00ffff; background: #000; margin-top: 5px; }
        #fill { background: #39ff14; height: 100%; width: 0%; box-shadow: 0 0 10px #39ff14; transition: width 0.3s; }
        canvas { width: 100%; height: 100%; position: absolute; left: 0; top: 0; }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div class="ui-panel">
        <span>LVL: <span id="lvl">1</span></span>
        <div style="text-align:center;">
            <span>PROGRESO</span>
            <div class="progress-bar"><div id="fill"></div></div>
        </div>
        <span>VIDAS: <span id="vds">❤️❤️❤️</span></span>
    </div>
    <canvas id="gameCanvas" width="400" height="600"></canvas>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// --- CARGA DE ASSETS REALISTAS ---
const imgFan = new Image();
imgFan.src = 'https://i.imgur.com/8y97U0X.png'; // Aspas de ventilador transparentes
const imgFanCase = new Image();
imgFanCase.src = 'https://i.imgur.com/mO3I7Vz.png'; // Marco del ventilador
const imgVirus = new Image();
imgVirus.src = 'https://i.imgur.com/6S3vE7X.png'; // Virus pixel-art rojo
const imgSponge = new Image();
imgSponge.src = 'https://i.imgur.com/yvD7R4E.png'; // Esponja limpia

let level = 1, lives = 3, frame = 0, gameRunning = true;
let sponge = { x: 175, y: 500, w: 50, h: 50 };
let dust = [], viruses = [], fanAngle = 0;

function initLevel() {
    dust = []; viruses = [];
    let amount = 15 + (level * 5);
    for(let i=0; i<amount; i++) {
        dust.push({ x: Math.random()*340+30, y: Math.random()*350+120, r: 5, active: true });
    }
    if(level >= 2) {
        for(let i=0; i<level; i++) {
            viruses.push({ x: Math.random()*350, y: 100, vx: 2, vy: 1.5, r: 20 });
        }
    }
}

function drawFan() {
    // Dibujar el marco (estático)
    ctx.drawImage(imgFanCase, 100, 200, 200, 200);
    
    // Dibujar las aspas (girando)
    ctx.save();
    ctx.translate(200, 300);
    fanAngle += 0.15; // Velocidad de giro
    ctx.rotate(fanAngle);
    ctx.drawImage(imgFan, -90, -90, 180, 180);
    ctx.restore();
}

canvas.addEventListener("touchmove", (e) => {
    e.preventDefault();
    let rect = canvas.getBoundingClientRect();
    let t = e.touches[0];
    sponge.x = (t.clientX - rect.left) * (400/rect.width) - 25;
    sponge.y = (t.clientY - rect.top) * (600/rect.height) - 25;
});

function loop() {
    if(!gameRunning) return;
    ctx.clearRect(0, 0, 400, 600);

    // Fondo oscuro semi-transparente para resaltar circuitos
    ctx.fillStyle = "rgba(0,0,0,0.4)";
    ctx.fillRect(0,0,400,600);

    if(level === 1 || level >= 4) drawFan();

    // Láser Neón con resplandor
    ctx.shadowBlur = 20;
    ctx.shadowColor = "#00ffff";
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(sponge.x + 25, sponge.y);
    ctx.lineTo(sponge.x + 25, 0);
    ctx.stroke();
    ctx.shadowBlur = 0;

    // Polvo (Mugre)
    ctx.fillStyle = "#553311";
    let activeDust = 0;
    dust.forEach(d => {
        if(d.active) {
            ctx.beginPath(); ctx.arc(d.x, d.y, d.r, 0, Math.PI*2); ctx.fill();
            // Limpieza por contacto o láser
            if(Math.hypot(sponge.x+25-d.x, sponge.y+25-d.y) < 35 || 
               (Math.abs(d.x - (sponge.x+25)) < 15 && d.y < sponge.y)) {
                d.active = false;
            }
            activeDust++;
        }
    });

    document.getElementById("fill").style.width = ((dust.length - activeDust) / dust.length * 100) + "%";

    // Virus
    viruses.forEach(v => {
        v.x += v.vx; v.y += v.vy;
        if(v.x < 0 || v.x > 360) v.vx *= -1;
        if(v.y < 50 || v.y > 400) v.vy *= -1;
        ctx.drawImage(imgVirus, v.x, v.y, 40, 40);
        if(Math.hypot(sponge.x+25-(v.x+20), sponge.y+25-(v.y+20)) < 40) {
            lives--;
            checkLives();
        }
    });

    // Personaje Esponja
    ctx.drawImage(imgSponge, sponge.x, sponge.y, sponge.w, sponge.h);

    if(activeDust === 0) {
        level++;
        if(level > 5) { alert("¡PC LIMPIA! ERES UN EXPERTO."); location.reload(); }
        else { document.getElementById("lvl").innerText = level; initLevel(); }
    }

    requestAnimationFrame(loop);
}

function checkLives() {
    document.getElementById("vds").innerText = "❤️".repeat(lives);
    if(lives <= 0) { alert("SISTEMA COLAPSADO"); location.reload(); }
    sponge.x = 175; sponge.y = 500;
}

// Iniciar juego cuando carguen las imágenes
imgFan.onload = () => { initLevel(); loop(); };
</script>
</body>
</html>
