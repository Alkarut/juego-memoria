<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CLEANMANT ULTIMATE - HD EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; 
            background: #000; 
            color: #fff; 
            text-align: center; 
            font-family: 'Press Start 2P', cursive; 
            overflow: hidden; 
            touch-action: none; 
        }
        /* Contenedor del juego con efecto de pantalla de monitor antiguo */
        #game-container {
            position: relative;
            margin: 10px auto;
            width: 400px;
            max-width: 95vw;
        }
        canvas { 
            display: none; 
            background: radial-gradient(circle, #0a1a2a 0%, #000 100%); 
            border: 4px solid #00ffff; 
            box-shadow: 0 0 20px #00ffff, inset 0 0 20px #00ffff; 
            border-radius: 10px;
        }
        .hud { 
            color: #00ffff; 
            font-size: 10px; 
            margin-bottom: 10px; 
            display: none; 
            justify-content: space-around; 
            text-shadow: 0 0 10px #00ffff;
        }
        #menu, #victory { 
            padding: 40px 20px; 
            border: 2px solid #ff00ff;
            background: rgba(0,0,0,0.8);
            box-shadow: 0 0 30px #ff00ff;
            display: inline-block;
            margin-top: 50px;
        }
        button { 
            padding: 15px 30px; 
            font-family: 'Press Start 2P', cursive; 
            background: #00ffff; 
            border: none; 
            cursor: pointer; 
            box-shadow: 4px 4px 0 #008b8b;
            margin-top: 20px;
            transition: 0.2s;
        }
        button:active { transform: translate(4px, 4px); box-shadow: 0 0 0; }
        .energy-bar { width: 100px; height: 12px; border: 2px solid #00ffff; background: #000; }
        #energyFill { background: #00ffff; height: 100%; width: 100%; box-shadow: 0 0 10px #00ffff; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="menu">
        <h1 style="color: #00ffff; text-shadow: 0 0 15px #00ffff;">CLEANMANT</h1>
        <p style="font-size: 8px; color: #ff00ff;">MODO: HARDWARE REPAIR</p>
        <button onclick="startGame()">CONECTAR</button>
    </div>

    <div id="victory" style="display:none;">
        <h1 style="color: #0f0;">SISTEMA LIMPIO</h1>
        <p style="font-size: 10px;">¡HAS LIMPIADO CON ÉXITO LA PC!</p>
        <button onclick="location.reload()">REINICIAR</button>
    </div>

    <div id="hud" class="hud">
        <span>LVL: <span id="lvl">1</span></span>
        <span>VIDAS: <span id="vds">❤️❤️❤️</span></span>
        <div class="energy-bar"><div id="energyFill"></div></div>
    </div>

    <canvas id="game" width="400" height="600"></canvas>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let level = 1, lives = 3, gameRunning = false, isFiring = false, energy = 100, frame = 0;
let sponge = { x: 175, y: 500 };
let dust = [], viruses = [], bubbles = [], fans = [], sparks = [];

// Función para mover la esponja (Compatible con PC y Celular)
function moveSponge(e) {
    if(!gameRunning) return;
    let clientX = e.touches ? e.touches[0].clientX : e.clientX;
    let clientY = e.touches ? e.touches[0].clientY : e.clientY;
    let rect = canvas.getBoundingClientRect();
    sponge.x = (clientX - rect.left) * (canvas.width / rect.width) - 25;
    sponge.y = (clientY - rect.top) * (canvas.height / rect.height) - (e.touches ? 60 : 25);
}

canvas.addEventListener("mousemove", moveSponge);
canvas.addEventListener("touchmove", (e) => { e.preventDefault(); moveSponge(e); }, {passive: false});
window.addEventListener("mousedown", () => isFiring = true);
window.addEventListener("mouseup", () => isFiring = false);
window.addEventListener("touchstart", () => isFiring = true);
window.addEventListener("touchend", () => isFiring = false);

function createLevel() {
    dust = []; viruses = []; bubbles = []; fans = []; sparks = [];
    let dustAmount = 20 + (level * 5);
    for(let i=0; i<dustAmount; i++) dust.push({ x: Math.random()*340+30, y: Math.random()*400+100, r: 5 });

    if(level === 1) fans.push({x: 200, y: 300, angle: 0});
    if(level === 2) for(let i=0; i<4; i++) viruses.push({x: Math.random()*300, y: 100, vx: 4, vy: 2, r: 15});
    if(level === 3) viruses.push({x: 200, y: 100, vx: 2, vy: 0, r: 30, boss: true});
    if(level === 4) sparks = [{y: 200}, {y: 400}];
    if(level === 5) {
        fans.push({x: 200, y: 300, angle: 0});
        viruses.push({x: 100, y: 100, vx: 3, vy: 3, r: 20});
        sparks = [{y: 150}];
    }
}

function drawBackground() {
    // Dibujar rejilla de fondo (Grid Cyberpunk)
    ctx.strokeStyle = "rgba(0, 255, 255, 0.1)";
    ctx.lineWidth = 1;
    for(let i=0; i<canvas.width; i+=40) {
        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke();
    }
    for(let i=0; i<canvas.height; i+=40) {
        ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); ctx.stroke();
    }
}

function update() {
    if(!gameRunning) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBackground();

    // Dibujar Ventilador (Niveles 1 y 5)
    fans.forEach(f => {
        ctx.save();
        ctx.translate(f.x, f.y);
        f.angle += 0.1;
        ctx.rotate(f.angle);
        ctx.fillStyle = "#333";
        for(let i=0; i<4; i++) {
            ctx.rotate(Math.PI/2);
            ctx.fillRect(-10, 0, 20, 80);
        }
        ctx.restore();
        if(Math.hypot(sponge.x+25-f.x, sponge.y+17-f.y) < 70) lives -= 0.05; // Daño constante
    });

    // Dibujar Virus
    viruses.forEach(v => {
        v.x += v.vx; v.y += v.vy;
        if(v.x < 20 || v.x > 380) v.vx *= -1;
        if(v.y < 20 || v.y > 400) v.vy *= -1;
        
        ctx.fillStyle = v.boss ? "#ff00ff" : "#ff3333";
        ctx.shadowBlur = 15; ctx.shadowColor = ctx.fillStyle;
        ctx.beginPath(); ctx.arc(v.x, v.y, v.r, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;
        
        if(Math.hypot(sponge.x+25-v.x, sponge.y+17-v.y) < v.r + 20) lives -= 0.05;
    });

    // Dibujar Polvo
    ctx.fillStyle = "#8b4513";
    dust.forEach(d => {
        ctx.beginPath(); ctx.arc(d.x, d.y, d.r, 0, Math.PI*2); ctx.fill();
    });
    dust = dust.filter(d => Math.hypot(sponge.x+25-d.x, sponge.y+17-d.y) > 35);

    // Láser
    if(isFiring && energy > 0) {
        energy -= 1.5;
        ctx.strokeStyle = "#00ffff"; ctx.lineWidth = 6;
        ctx.shadowBlur = 20; ctx.shadowColor = "#00ffff";
        ctx.beginPath(); ctx.moveTo(sponge.x+25, sponge.y); ctx.lineTo(sponge.x+25, 0); ctx.stroke();
        ctx.shadowBlur = 0;
        dust = dust.filter(d => !(Math.abs(d.x - (sponge.x + 25)) < 15 && d.y < sponge.y));
    } else if(energy < 100) energy += 0.5;
    document.getElementById("energyFill").style.width = energy + "%";

    // Dibujar Esponja (Cleanmant)
    ctx.fillStyle = "#ffff00";
    ctx.shadowBlur = 15; ctx.shadowColor = "#ffff00";
    ctx.fillRect(sponge.x, sponge.y, 50, 35);
    ctx.shadowBlur = 0;

    // UI Updates
    document.getElementById("vds").innerText = "❤️".repeat(Math.ceil(lives));
    if(lives <= 0) { alert("SISTEMA CRASHED"); location.reload(); }

    if(dust.length === 0) {
        if(level >= 5) {
            gameRunning = false;
            canvas.style.display = "none";
            document.getElementById("hud").style.display = "none";
            document.getElementById("victory").style.display = "block";
        } else {
            level++;
            document.getElementById("lvl").innerText = level;
            createLevel();
        }
    }
    frame++;
    requestAnimationFrame(update);
}

function startGame() {
    document.getElementById("menu").style.display = "none";
    document.getElementById("hud").style.display = "flex";
    canvas.style.display = "block";
    gameRunning = true;
    createLevel();
    update();
}
</script>
</body>
</html>
