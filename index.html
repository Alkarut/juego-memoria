<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CLEANMANT MOBILE - Virus Attack</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
body {
    margin: 0;
    background: radial-gradient(circle, #050a0c, #000);
    color: white;
    text-align: center;
    font-family: 'Press Start 2P', cursive;
    overflow: hidden;
    touch-action: none;
}
canvas {
    display: none;
    background: #0a0a0a;
    border: 4px solid #00ffff;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
    margin: 10px auto;
    max-width: 95vw;
    max-height: 80vh;
}
#menu { margin-top: 80px; padding: 20px; }
button {
    padding: 20px 40px;
    font-family: 'Press Start 2P', cursive;
    background: cyan;
    border: none;
    box-shadow: 0 5px 0 #008b8b;
    cursor: pointer;
    margin-top: 20px;
}
.hud {
    color: cyan;
    font-size: 10px;
    margin: 10px;
    display: none;
    display: flex;
    justify-content: space-around;
}
.shock { animation: shake 0.1s infinite; }
@keyframes shake {
    0% { transform: translate(3px, 3px); }
    50% { transform: translate(-3px, -3px); }
    100% { transform: translate(0, 0); }
}
</style>
</head>
<body>

<div id="menu">
    <h1>üßΩ CLEANMANT</h1>
    <p style="font-size: 10px; line-height: 1.6;">
        Limpia el PC.<br>
        ¬°Cuidado con las BURBUJAS!<br>
        Mant√©n presionado para L√ÅSER.
    </p>
    <button onclick="startGame()">JUGAR</button>
</div>

<div id="hud" class="hud">
    <span>NIVEL: <span id="lvl">1</span></span>
    <span>VIDAS: <span id="vds">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span>
    <span>ENERG√çA: <span id="energy">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span></span>
</div>

<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let level = 1;
let lives = 3;
let gameRunning = false;
let isFiring = false;
let shockTimer = 0;
let laserEnergy = 100;

let sponge = { x: 175, y: 500, size: 50 };
let dust = [];
let viruses = [];
let bubbles = [];
let powerUps = [];

function moveSponge(e) {
    e.preventDefault();
    let clientX, clientY;
    if (e.touches) {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
    } else {
        clientX = e.clientX;
        clientY = e.clientY;
    }
    let rect = canvas.getBoundingClientRect();
    let scaleX = canvas.width / rect.width;
    let scaleY = canvas.height / rect.height;
    sponge.x = (clientX - rect.left) * scaleX - 25;
    sponge.y = (clientY - rect.top) * scaleY - (e.touches ? 80 : 25);
}

canvas.addEventListener("mousemove", moveSponge);
canvas.addEventListener("touchmove", moveSponge);
canvas.addEventListener("mousedown", () => isFiring = true);
canvas.addEventListener("mouseup", () => isFiring = false);
canvas.addEventListener("touchstart", (e) => { isFiring = true; moveSponge(e); });
canvas.addEventListener("touchend", () => isFiring = false);

function drawVirus(v) {
    ctx.save();
    ctx.translate(v.x, v.y);
    if(v.type==="fast") ctx.fillStyle="#ff7700";
    else if(v.type==="armored") ctx.fillStyle="#880000";
    else ctx.fillStyle="#ff1111";

    ctx.beginPath(); ctx.arc(0,0,v.r,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle = "#ff1111";
    ctx.lineWidth = 2;
    for(let i=0;i<8;i++){
        let ang=(i/8)*Math.PI*2+(Date.now()/500);
        ctx.beginPath(); ctx.moveTo(0,0);
        ctx.lineTo(Math.cos(ang)*22, Math.sin(ang)*22); ctx.stroke();
    }
    ctx.fillStyle="white";
    ctx.fillRect(-6,-5,4,4); ctx.fillRect(2,-5,4,4);
    ctx.restore();

    if(Math.random()<0.02) {
        bubbles.push({ x:v.x, y:v.y, r:8+Math.random()*4, vy:3+level });
    }
}

function drawBubbles() {
    ctx.strokeStyle="rgba(0,255,255,0.8)";
    ctx.lineWidth=2;
    bubbles.forEach((b,i)=>{
        b.y+=b.vy;
        ctx.beginPath();
        ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
        ctx.stroke();
        ctx.fillStyle="rgba(0,255,255,0.2)";
        ctx.fill();
        let dist=Math.hypot((sponge.x+25)-b.x,(sponge.y+17)-b.y);
        if(dist<30 && shockTimer<=0){
            bubbles.splice(i,1);
            takeDamage();
        }
        if(b.y>600) bubbles.splice(i,1);
    });
}

function takeDamage() {
    lives--;
    shockTimer=40;
    canvas.classList.add("shock");
    document.getElementById("vds").innerText="‚ù§Ô∏è".repeat(lives);
    if(lives<=0){
        alert("GAME OVER - Virus detectado");
        location.reload();
    }
}

function drawTower() {
    let g=ctx.createLinearGradient(100,100,300,100);
    g.addColorStop(0,"#111"); g.addColorStop(0.5,"#333"); g.addColorStop(1,"#111");
    ctx.fillStyle=g; ctx.fillRect(100,100,200,350);
}

function drawComputer() {
    ctx.fillStyle="#1a1a1a"; ctx.fillRect(60,150,280,180);
    let screen=ctx.createLinearGradient(70,160,70,320);
    screen.addColorStop(0,"#001"); screen.addColorStop(1,"#003");
    ctx.fillStyle=screen; ctx.fillRect(70,160,260,150);
}

function drawMouse() {
    let mGrd=ctx.createRadialGradient(200,250,20,200,250,80);
    mGrd.addColorStop(0,"#444"); mGrd.addColorStop(1,"#050505");
    ctx.fillStyle=mGrd;
    ctx.beginPath(); ctx.ellipse(200,250,55,85,0,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="cyan"; ctx.fillRect(196,200,8,25);
}

function drawSponge() {
    ctx.fillStyle=(shockTimer>0 && shockTimer%2===0)?"white":"#ffd700";
    ctx.beginPath();
    ctx.roundRect(sponge.x,sponge.y,50,35,8);
    ctx.fill();
}

function drawLaser() {
    if(isFiring && laserEnergy>0 && shockTimer<=0){
        ctx.shadowBlur=15; ctx.shadowColor="cyan";
        ctx.strokeStyle="white"; ctx.lineWidth=4;
        ctx.beginPath(); ctx.moveTo(sponge.x+25,sponge.y);
        ctx.lineTo(sponge.x+25,0); ctx.stroke();
        ctx.shadowBlur=0;
        dust=dust.filter(d=>(Math.abs(d.x-(sponge.x+25))>18 || d.y>sponge.y));
        laserEnergy--;
    }
    if(!isFiring && laserEnergy<100){
        laserEnergy+=0.5;
    }
    let bars=Math.floor(laserEnergy/10);
    document.getElementById("energy").innerText="‚ñà".repeat(bars)+" ".repeat(10-bars);
}

function createLevel() {
    dust=[]; bubbles=[]; powerUps=[];
    for(let i=0;i<25+(level*5);i++){
        dust.push({x:Math.random()*300+50,y:Math.random()*300+100,r:5,vy:Math.random()*0.2-0.1});
    }
    viruses=[];
    for(let i=0;i<level+2;i++){
        let type=Math.random()<0.4?"fast":Math.random()<0.6?"armored":"normal";
        viruses.push({
            x:Math.random()*350, y:Math.random()*200,
            vx:(Math.random()-0.5)(type==="fast"?6:3), vy:(Math.random()-0.5)(type==="fast"?6:3),
            r:12, type:type, health:type==="armored"?3:1
        });
    }
    // Power-ups aleatorios
    if(Math.random()<0.5){
        powerUps.push({x:Math.random()*300+50, y:Math.random()*300+100, type:"heart"});
    }
    if(Math.random()<0.5){
        powerUps.push({x:Math.random()*300+50, y:Math.random()*300+100, type:"superlaser"});
    }
}

function drawPowerUps() {
    powerUps.forEach((p,i)=>{
        ctx.fillStyle=p.type==="heart"?"red":"cyan";
        ctx.beginPath(); ctx.arc(p.x,p.y,12,0,Math.PI*2); ctx.fill();
        let dist=Math.hypot((sponge.x+25)-p.x,(sponge.y+17)-p.y);
        if(dist<25){
            if(p.type==="heart"){ lives=Math.min(lives+1,3); document.getElementById("vds").innerText="‚ù§Ô∏è".repeat(lives);}
            if(p.type==="superlaser"){ laserEnergy=Math.min(laserEnergy+50,100);}
            powerUps.splice(i,1);
        }
    });
}

function update() {
    if(!gameRunning) return;
    ctx.clearRect(0,0,400,600);

    if(level===1) drawTower();
    else if(level===2) drawComputer();
    else drawMouse();

    dust.forEach(d=>{ d.y+=d.vy; ctx.fillStyle="#8b4513"; ctx.beginPath(); ctx.arc(d.x,d.y,d.r,0,Math.PI*2); ctx.fill(); });

    viruses.forEach((v,i)=>{
        v.x+=v.vx; v.y+=v.vy;
        if(v.x<0||v.x>400)v.vx*=-1;
        if(v.y<0||v.y>600)v.vy*=-1;
        drawVirus(v);

        // Colisi√≥n con esponja
        let dist=Math.hypot((sponge.x+25)-v.x,(sponge.y+17)-v.y);
        if(dist<32 && shockTimer<=0) takeDamage();

        // Colisi√≥n con l√°ser
        if(isFiring && laserEnergy>0 && sponge.y>v.y){
            v.health--;
            if(v.health<=0) viruses.splice(i,1);
        }
    });

    drawBubbles();
    drawPowerUps();

    if(shockTimer>0){ shockTimer--; if(shockTimer===0) canvas.classList.remove("shock"); }

    drawLaser();
    drawSponge();

    if(dust.length===0){
        level++;
        if(level>3){ alert("¬°PC LIMPIA! Eres un genio."); location.reload(); }
        else{
            document.getElementById("lvl").innerText=level;
            createLevel();
        }
    }
    requestAnimationFrame(update);
}

function startGame(){
    document.getElementById("menu").style.display="none";
    document.getElementById("hud").style.display="flex";
    canvas.style.display="block";
    gameRunning=true;
    level=1;lives=3;laserEnergy=100;
    createLevel();
    update();
}
</script>

</body>
</html>
