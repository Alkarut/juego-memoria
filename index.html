<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CLEANMANT ULTIMATE</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: white; text-align: center; font-family: 'Press Start 2P', cursive; overflow: hidden; touch-action: none; }
        canvas { display: none; background: #050505; border: 4px solid #00ffff; box-shadow: 0 0 30px rgba(0, 255, 255, 0.3); margin: 10px auto; max-width: 95vw; max-height: 85vh; }
        #menu, #victory { margin-top: 80px; padding: 20px; }
        #victory { display: none; color: #0f0; }
        button { padding: 20px 40px; font-family: 'Press Start 2P', cursive; background: #00ffff; border: none; cursor: pointer; box-shadow: 0 5px 0 #008b8b; margin-top: 20px; }
        .hud { color: cyan; font-size: 10px; margin: 10px; display: none; justify-content: space-around; align-items: center; }
        .energy-bar { width: 80px; height: 10px; border: 1px solid cyan; }
        #energyFill { background: cyan; height: 100%; width: 100%; }
        .shock { animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(0, 0); } }
    </style>
</head>
<body>

<div id="menu">
    <h1>üßΩ CLEANMANT</h1>
    <p style="font-size: 10px;">5 NIVELES DE DESAF√çO</p>
    <button onclick="startGame()">INICIAR</button>
</div>

<div id="victory">
    <h1>üèÜ ¬°VICTORIA!</h1>
    <p>HAS LIMPIADO CON √âXITO LA PC</p>
    <p id="finalScore" style="font-size: 12px; color: yellow;"></p>
    <button onclick="location.reload()">REINTENTAR</button>
</div>

<div id="hud" class="hud">
    <span>LVL: <span id="lvl">1</span>/5</span>
    <span>VIDAS: <span id="vds">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span>
    <span>L√ÅSER: <div class="energy-bar"><div id="energyFill"></div></div></span>
</div>

<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let level = 1, lives = 3, gameRunning = false, isFiring = false, shockTimer = 0;
let energy = 100, frame = 0, score = 0;
let sponge = { x: 175, y: 500 };
let dust = [], viruses = [], bubbles = [], fans = [], sparks = [];

function moveSponge(e) {
    if(!gameRunning) return;
    let clientX = e.touches ? e.touches[0].clientX : e.clientX;
    let clientY = e.touches ? e.touches[0].clientY : e.clientY;
    let rect = canvas.getBoundingClientRect();
    sponge.x = (clientX - rect.left) * (canvas.width / rect.width) - 25;
    sponge.y = (clientY - rect.top) * (canvas.height / rect.height) - (e.touches ? 60 : 25);
}

canvas.addEventListener("mousemove", moveSponge);
canvas.addEventListener("touchmove", (e) => { e.preventDefault(); moveSponge(e); }, {passive: false});
window.addEventListener("mousedown", () => isFiring = true);
window.addEventListener("mouseup", () => isFiring = false);
window.addEventListener("touchstart", () => isFiring = true);
window.addEventListener("touchend", () => isFiring = false);

function takeDamage() {
    if(shockTimer > 0) return;
    lives--;
    shockTimer = 40;
    canvas.classList.add("shock");
    document.getElementById("vds").innerText = "‚ù§Ô∏è".repeat(lives);
    if(lives <= 0) { alert("SISTEMA CRASHED"); location.reload(); }
}

function createLevel() {
    dust = []; bubbles = []; viruses = []; fans = []; sparks = []; energy = 100;
    let dustAmount = 15 + (level * 10);
    for(let i=0; i<dustAmount; i++) dust.push({ x: Math.random()*340+30, y: Math.random()*400+50, r: 4 });

    if(level === 1) fans.push({x: 200, y: 300, angle: 0});
    else if(level === 2) for(let i=0; i<3; i++) viruses.push({x: Math.random()*300, y: 100, vx: 5, vy: 3, r: 15});
    else if(level === 3) viruses.push({x: 200, y: 80, vx: 2, vy: 0, r: 25, boss: true});
    else if(level === 4) sparks = [{y: 200}, {y: 400}];
    else if(level === 5) {
        viruses.push({x: 100, y: 80, vx: 3, vy: 3, r: 20});
        fans.push({x: 200, y: 300, angle: 0});
        sparks = [{y: 150}];
    }
}

function update() {
    if(!gameRunning) return;
    ctx.clearRect(0, 0, 400, 600);
    
    // Dibujo de fondo
    ctx.strokeStyle = "#001a1a";
    for(let i=0; i<400; i+=40) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,600); ctx.stroke(); }

    // Obst√°culos (Chispas, Fans, Virus)
    sparks.forEach(s => {
        if(Math.sin(frame * 0.05) > 0.5) {
            ctx.strokeStyle = "yellow"; ctx.lineWidth = 4;
            ctx.beginPath(); ctx.moveTo(0, s.y); ctx.lineTo(400, s.y); ctx.stroke();
            if(Math.abs(sponge.y + 17 - s.y) < 15) takeDamage();
        }
    });

    fans.forEach(f => {
        ctx.save(); ctx.translate(f.x, f.y); f.angle += 0.1; ctx.rotate(f.angle);
        ctx.strokeStyle = "#333"; ctx.lineWidth = 10;
        for(let i=0; i<4; i++) { ctx.rotate(Math.PI/2); ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0, 70); ctx.stroke(); }
        ctx.restore();
        if(Math.hypot(sponge.x+25-f.x, sponge.y+17-f.y) < 70) takeDamage();
    });

    viruses.forEach(v => {
        if(v.boss) v.x += (sponge.x + 25 > v.x) ? 2 : -2;
        else { v.x += v.vx; v.y += v.vy; if(v.x < 15 || v.x > 385) v.vx *= -1; if(v.y < 15 || v.y > 350) v.vy *= -1; }
        ctx.fillStyle = v.boss ? "#f0f" : "#f11";
        ctx.beginPath(); ctx.arc(v.x, v.y, v.r, 0, Math.PI*2); ctx.fill();
        if(Math.random() < 0.02) bubbles.push({x: v.x, y: v.y, vy: 4 + level});
        if(Math.hypot(sponge.x+25-v.x, sponge.y+17-v.y) < v.r + 20) takeDamage();
    });

    // Burbujas
    bubbles.forEach((b, i) => {
        b.y += b.vy;
        ctx.strokeStyle = "cyan"; ctx.beginPath(); ctx.arc(b.x, b.y, 8, 0, Math.PI*2); ctx.stroke();
        if(Math.hypot(sponge.x+25-b.x, sponge.y+17-b.y) < 25) { bubbles.splice(i,1); takeDamage(); }
        if(b.y > 600) bubbles.splice(i,1);
    });

    // L√°ser y Energ√≠a
    if(isFiring && energy > 0 && shockTimer <= 0) {
        energy -= 2;
        ctx.strokeStyle = "white"; ctx.lineWidth = 4;
        ctx.beginPath(); ctx.moveTo(sponge.x+25, sponge.y); ctx.lineTo(sponge.x+25, 0); ctx.stroke();
        dust = dust.filter(d => !(Math.abs(d.x - (sponge.x + 25)) < 15 && d.y < sponge.y));
    } else if(energy < 100) energy += 0.5;
    document.getElementById("energyFill").style.width = energy + "%";

    // Polvo y Esponja
    ctx.fillStyle = "#5c4033";
    dust.forEach(d => { ctx.beginPath(); ctx.arc(d.x, d.y, d.r, 0, Math.PI*2); ctx.fill(); });
    dust = dust.filter(d => Math.hypot(sponge.x+25-d.x, sponge.y+17-d.y) > 35);

    ctx.fillStyle = (shockTimer > 0 && Math.floor(frame/2)%2) ? "red" : "#ffd700";
    ctx.beginPath(); ctx.roundRect(sponge.x, sponge.y, 50, 35, 8); ctx.fill();

    if(shockTimer > 0) { shockTimer--; if(shockTimer === 0) canvas.classList.remove("shock"); }

    if(dust.length === 0) {
        if(level >= 5) winGame();
        else { level++; document.getElementById("lvl").innerText = level; createLevel(); }
    }
    frame++;
    requestAnimationFrame(update);
}

function winGame() {
    gameRunning = false;
    canvas.style.display = "none";
    document.getElementById("hud").style.display = "none";
    document.getElementById("victory").style.display = "block";
    document.getElementById("finalScore").innerText = "BONUS POR VIDAS: " + (lives * 1000) + " PTS";
}

function startGame() {
    document.getElementById("menu").style.display = "none";
    document.getElementById("hud").style.display = "flex";
    canvas.style.display = "block";
    gameRunning = true;
    createLevel();
    update();
}
</script>
</body>
</html>
